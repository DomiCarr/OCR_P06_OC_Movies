Generated 2025-11-06 18:01:34



===========================================================================================
   index.html
===========================================================================================
<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200;300;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./style/ocmovies_desktop.css">
    <link rel="stylesheet" href="./style/ocmovies_tablet.css">
    <link rel="stylesheet" href="./style/ocmovies_mobil.css">

    <script src="scripts/config.js" defer></script>
    <script src="scripts/api/rest_api.js" defer></script>
    <script src="scripts/ui/modal.js" defer></script>
    <script src="scripts/ui/menu.js" defer></script>
    <script src="scripts/ui/tiles.js" defer></script>
    <script src="scripts/events.js" defer></script>
    <script src="scripts/main.js" defer></script>

    <title>OCMovies</title>
</head>

<body>
    <header>
        <div class="header_pic">
            <img src="./assets/pictures/just_dream_it.png" alt="Logo OCMovies">
        </div>
        <div class="header_text">Vidéos à la demande</div>
    </header>

    <main>
        <!-- Best movie -->
        <div class="bloc_film" data-category="best">
            <div class="bf_titre">best</div>
            <div class="bf_vignette"></div>
        </div>

        <!-- Best rated movies -->
        <div class="bloc_film" data-category="top_rated">
            <div class="bf_titre">top_rated</div>
            <div class="bf_mosaik">
                <div class="tuiles"></div>
                <button class="bf_voir_plus_bouton">Voir plus</button>
            </div>
        </div>

        <!-- Category 1 -->
        <div class="bloc_film" data-category="category1">
            <div class="bf_titre">Mystery</div>
            <div class="bf_mosaik">
                <div class="tuiles"></div>
                <button class="bf_voir_plus_bouton">Voir plus</button>
            </div>
        </div>

        <!-- Category 2 -->
        <div class="bloc_film" data-category="category2">
            <div class="bf_titre">Comedy</div>
            <div class="bf_mosaik">
                <div class="tuiles"></div>
                <button class="bf_voir_plus_bouton">Voir plus</button>
            </div>
        </div>

        <!-- Others -->
        <div class="bloc_film" data-category="others">
            <div class="bf_titre_autre">
                <div class="bf_titre">others</div>
                <div class="bf_menu">
                    <ul id="genres"></ul>
                </div>
            </div>
            <div class="bf_mosaik">
                <div class="tuiles"></div>
                <button class="bf_voir_plus_bouton">Voir plus</button>
            </div>
        </div>
    </main>

    <!-- Modal: movie details -->
    <div id="modale" class="modale hidden_modale">
        <div class="content">
            <div class="top">
                <div class="top_text">
                    <div class="top_info">
                        <div class="top_info_tit"></div>
                        <div class="top_info_text"></div>
                    </div>
                    <div class="top_real">
                        <div class="top_real_tit">Réalisé par:</div>
                        <div class="top_real_text"></div>
                    </div>
                </div>
                <div class="modal_desktop_pic"><img src="" alt="Poster film"></div>
                <button id="iconCloseModal" class="icon_close_modal">X</button>
            </div>
            <div class="desc_text"></div>
            <div class="modal_tab_mob_pic"><img src="" alt="Poster mobile"></div>
            <div class="desc_avec">
                <div class="desc_avec_tit">Avec:</div>
                <div class="desc_avec_text"></div>
            </div>
            <button id="btnCloseModal" class="btn_close_modal">Fermer</button>
        </div>
    </div>
</body>

</html>


===========================================================================================
    ./scripts/api/rest_api.js 
===========================================================================================
// rest_api.js
//
// Exchange with API_REST functions
//
// ==================================================

// --------------------------------------------------
// Extract genres from API page
//
// input: - data : JSON object from API response
// output: - list of genres [{id, name}] extracted from page
//
// --------------------------------------------------
//
function extractGenresFromPage(data) {
    const list = data.results;
    const genres = [];

    for (let i = 0; i < list.length; i++) {
        genres.push({
            id: list[i].id,
            name: list[i].name
        });
    }
    return genres;
}

// --------------------------------------------------
// Fetch all genres from API
//
// input: - uses global genresUrl
// output: - Promise resolving to array of all genres [{id, name}]
//
// --------------------------------------------------
//
async function getAllGenres() {
    // Initialize an empty array to store all genres from all pages
    let allGenres = [];

    // Start fetching from the first page
    let page = 1;

    // Flag to control the loop: true if there is a next page
    let hasNext = true;

    // Loop until there are no more genre pages
    while (hasNext) {
        try {
            // For the current genre page:
            // Send an HTTP GET request to REST_API and wait for the response
            // `fetch()` returns a Promise for the response
            // `await` pauses execution until the Promise resolves, giving the Response object
            const response = await fetch(`${genresUrl}?page=${page}`);

            // Throw an error to be caught by the catch block
            // if the HTTP response status is not OK
            if (!response.ok) {
                throw new Error("HTTP error: " + response.status);
            }

            // Parse the HTTP response as JSON:
            // `await` ensures the code waits until the JSON is fully read and converted
            // into a JavaScript object before assigning it to `data`
            const data = await response.json();

            // Extract genres from the current page
            const genres = extractGenresFromPage(data);

            // Append the current page's genres to the full list
            allGenres = allGenres.concat(genres);

            // Check if there is another page of results in the API
            // data.next is a field in the JSON returned by the API for this page
            // It contains the URL of the next page, or null if there are no more pages
            // We set hasNext to true/false accordingly to control the loop
            hasNext = data.next !== null;

            // Move to the next page number
            page++;
        } catch (error) {
            // Log any fetch or parsing errors and stop the loop
            console.error("Error fetching page", page, error);
            hasNext = false;
        }
    }

    // Log all collected genres for debugging
    console.log(allGenres);

    // Return the full array of genres
    return allGenres;
}

// --------------------------------------------------
// Fetch the best movie (highest IMDB score) from all genres
//
// input:  - none
// output: - movie object {id, title, image_url, description, directors, actors, writers, genres, ...}
//
// --------------------------------------------------

async function getBestMovie() {
    try {
        // Step 1: fetch first page of all movies sorted by IMDB score descending
        const response = await fetch(`${titlesUrl}?sort_by=-imdb_score&page=1`);
        if (!response.ok) throw new Error("HTTP error fetching top movies: " + response.status);
        const data = await response.json();
        if (!data.results || data.results.length === 0) return null;

        // Take the first movie (highest score)
        const topMovie = data.results[0];

        // Step 2: fetch full details for this movie by its id
        const detailResponse = await fetch(`${titlesUrl}${topMovie.id}`);
        if (!detailResponse.ok) throw new Error("HTTP error fetching movie details: " + detailResponse.status);
        const movieDetails = await detailResponse.json();

        return movieDetails;

    } catch (error) {
        console.error("Error fetching best movie:", error);
        return null;
    }
}



// --------------------------------------------------
// Extract first 6 best movies for a given genre, sorted by IMDB score descending
// If genre === All the the best movies all genres are extracted
//
// input: - genre : string
// output: - movies: array of up to 6 movies [{id, title, image_url}]
//
// --------------------------------------------------
async function extractBestMoviesByGenre(genre) {
    const movies = [];
    let page = 1;

    console.log("Fetching top movies for genre:", genre);

    while (movies.length < 6) {
        let url;
        // Build the url depending if there is a specific genre or all genre
        if (genre === "all") {
            url = `${titlesUrl}?sort_by=-imdb_score&page=${page}`;
        } else {
            url = `${titlesUrl}?genre=${encodeURIComponent(genre)}&sort_by=-imdb_score&page=${page}`;
        }


        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error("HTTP error: " + response.status);
            }

            const data = await response.json();
            console.log("Movies returned this page:", data.results.length);

            for (let movie of data.results) {
                if (movies.length >= 6) break;
                movies.push({
                    id: movie.id,
                    title: movie.title,
                    image_url: movie.image_url,
                });
            }

            if (data.results.length === 0) break;
            page++;
        } catch (error) {
            console.error("Error fetching movies for genre", genre, error);
            break;
        }
    }

    console.log("Top movies array ready:", movies);
    return movies;
}


// --------------------------------------------------
// Fetch detailed information for a single movie by its ID
//
// input: - movieId : string or number
// output: - Promise resolving to a movie object
//          {id, title, description, image_url, directors, actors, ...}
//
// --------------------------------------------------
async function getMovieDetails(movieId) {
    try {
        const response = await fetch(`${titlesUrl}${movieId}`);
        if (!response.ok) {
            throw new Error("HTTP error: " + response.status);
        }

        const data = await response.json();

        // Normalize data for UI consumption
        const movie = {
            id: data.id,
            title: data.title,
            description: data.description,
            image_url: data.image_url,
            directors: data.directors || [],
            actors: data.actors || [],
            genres: data.genres || [],
            year: data.year,
            imdb_score: data.imdb_score,
            country: data.country,
            language: data.lang,
            rating: data.rating,
            company: data.company
        };

        return movie;

    } catch (error) {
        console.error("Error fetching movie details for ID", movieId, error);
        return null;
    }
}



===========================================================================================
    ./scripts/config.js 
===========================================================================================
// config.js
//
// Configuration file for global constants and variables
// Contains API URLs and application-wide settings
//


// URL of the REST API for genres
const genresUrl = "http://localhost:8000/api/v1/genres/";

// URL of the REST API for movie titles
const titlesUrl = "http://localhost:8000/api/v1/titles/";

// Global variable to store the currently selected genre
let selectedGenre = "";




===========================================================================================
    ./scripts/events.js 
===========================================================================================
//events.js
//
// Manage event listeners for user interactions: button clicks, menu hovers, etc.
//
// ==================================================

// --------------------------------------------------
// Initialize event listeners for UI interactions
//
// input: - genres: list of genres from API_REST
// output: - DOM updated with click/hover handlers
//
// --------------------------------------------------
//
function listenEvents(genres) {
    // movie detail button
    const btnDetails = document.querySelector("#btnDetails");
    btnDetails.addEventListener("click", () => Toggle_modale());

    // close modal button
    const btnCloseModal = document.querySelector("#btnCloseModal");
    btnCloseModal.addEventListener("click", () => Toggle_modale());

    // close modal icon
    const iconCloseModal = document.querySelector("#iconCloseModal");
    iconCloseModal.addEventListener("click", () => Toggle_modale());

    // "voir plus" buttons
    // Select all "Voir plus" buttons and iterate over them
    document.querySelectorAll(".bf_voir_plus_bouton").forEach((btn) => {

        // Add a click event listener to toggle the display of extra tiles
        btn.addEventListener("click", () => {

            // Find the parent container (.bf_mosaik) that holds the tiles
            const bloc = btn.closest(".bf_mosaik");

            // Toggle a class to show or hide all tiles in the container
            bloc.classList.toggle("show_all_tiles");

            // If the container has the class "show_all_tiles", set button text to "Voir moins"
            // Otherwise, set it to "Voir plus"
            if (bloc.classList.contains("show_all_tiles")) {
                btn.textContent = "Voir moins";
            } else {
                btn.textContent = "Voir plus";
            }
        });
    });

    // ----- Dynamic movie detail buttons (inside generated tiles) -----
    // Use event delegation to handle dynamically created tiles
    document.addEventListener("click", (event) => {
        const btn = event.target.closest(".tuile_bloctexte_button");
        if (!btn) return;
        const movieId = btn.dataset.id;
        if (movieId) Toggle_modale(movieId);
    });

    // Initialize and manage the genre menu behavior (hover, click, display)
    manageMenu(genres);
}



===========================================================================================
    ./scripts/main.js 
===========================================================================================
// main.js
//
// Application entry script
//
// ==================================================

// --------------------------------------------------
// Initialize application
//
// input: - none (uses global config & API)
// output: - generate page content and event listeners
//
// --------------------------------------------------
async function buildPageContent(genres) {

    try {
        // ----- Best movie (single top IMDB) -----
        const bestMovie = await getBestMovie();
        generateBestMovie(bestMovie);

        // ----- Top rated (all genres) -----
        const topRatedMovies = await extractBestMoviesByGenre("all");
        generateTiles("top_rated", topRatedMovies);

        // ----- Mystery Mosaik -----
        const moviesMystery = await extractBestMoviesByGenre("Mystery");
        generateTiles("category1", moviesMystery);

        // ----- Comedy Mosaik -----
        const moviesComedy = await extractBestMoviesByGenre("Comedy");
        generateTiles("category2", moviesComedy);

        // ----- Others Mosaik -----
        const moviesOthers = await extractBestMoviesByGenre(genres[0].name);
        generateTiles("others", moviesOthers);

    } catch (error) {
        console.error("Error building page content:", error);
    }
}

// --------------------------------------------------
// App entry point
//
// input: - none
// output: - initialized dynamic page
//
// --------------------------------------------------

async function initApp() {
    try {
        // Fetch genres from API and generate menu
        const genres = await getAllGenres();
        generateMenu(genres);

        // Build all page content dynamically
        await buildPageContent(genres);

        // Initialize event listeners after tiles are generated
        listenEvents(genres);

    } catch (error) {
        console.error("Initialization error:", error);
    }
}

initApp();



===========================================================================================
    ./scripts/ui/menu.js 
===========================================================================================
// menu.js
//
// Handle the genre menu and its interactive behavior
//
// ==================================================

// Genres menu is open or closed
let menuOuvert = false;

// --------------------------------------------------
// Generate genres menu
//
// input: - genres : list of genres from the API_REST
// output: - DOM updated by the function
//
// --------------------------------------------------
//
function generateMenu(genres) {
    // if no selected genre assign the first genre
    if (!selectedGenre && genres.length > 0) {
        selectedGenre = genres[0].name;
    }

    const ul = document.getElementById("genres");
    ul.innerHTML = "";

    for (let i = 0; i < genres.length; i++) {
        const li = document.createElement("li");
        li.textContent = genres[i].name;

        // cursor changes as a hand on hover to visually indicate the item is clickable
        li.style.cursor = "pointer";

        // Attach click for every li:
        // Click always selects the genre and closes the menu
        li.addEventListener("click", () => {
            updateSelectedGenre(li);
            menuOuvert = false;
            menuDisplay(false, genres);
        });

        // hide all except first
        if (i !== 0) li.style.display = "none";

        ul.appendChild(li);
    }
}

// --------------------------------------------------
// Update selected genre
//
// input: - clickedItem : <li> DOM element clicked by user
// output: - DOM first item updated
//         - selectedGenre global variable updated
//
// --------------------------------------------------
//
function updateSelectedGenre(clickedItem) {
    // Get the <ul> that contains the genre menu
    const ul = document.getElementById("genres");

    // Select the first <li> item (main displayed genre)
    const firstItem = ul.querySelector("li");

    // Update the visible genre name to the clicked one
    firstItem.textContent = clickedItem.textContent;

    // Store the selected genre globally
    selectedGenre = clickedItem.textContent;
}

// --------------------------------------------------
// Display or hide genre menu
//
// input: - show : boolean, true = show menu, false = hide
//        - genres : list of genres from the API_REST
// output: - DOM updated: menu items shown/hidden, emoji set
//
// --------------------------------------------------
//
function menuDisplay(show, genres) {
    // Get all genre items from the menu
    const menuItems = document.querySelectorAll("#genres li");
    if (menuItems.length <= 1) return;

    // Loop through items (skip first) and show/hide them
    for (let i = 1; i < menuItems.length; i++) {
        menuItems[i].style.display = show ? "block" : "none";

        // Remove checkmark emoji from the previously selected genre
        menuItems[i].textContent = menuItems[i].textContent.replace(" ✅", "");

        // Add checkmark emoji for the currently selected genre
        if (show && menuItems[i].textContent === selectedGenre) {
            menuItems[i].textContent = selectedGenre + " ✅";
        }
    }

    // Update first item text based on menu state
    const firstItem = menuItems[0];
    if (show) {
        // Show the first genre name when menu opens
        firstItem.textContent = genres[0].name;

        // Add emoji if it's the selected one
        if (selectedGenre === genres[0].name) {
            firstItem.textContent = selectedGenre + " ✅";
        }
    } else {
        // Hide menu and show only the selected genre
        firstItem.textContent = selectedGenre;
    }
}

// --------------------------------------------------
// Manage hover behavior on genre menu
//
// input: - genres : list of genres from the API_REST
// output: - event listeners attached
//         - DOM updated on hover enter/leave
//
// --------------------------------------------------
//
function manageMenu(genres) {
    // Select the genre menu container element
    const menu = document.querySelector(".bf_menu");
    if (!menu) return;

    // Show full menu when hovering
    menu.addEventListener("mouseenter", () => {
        menuOuvert = true;
        const ul = document.getElementById("genres");
        const firstItem = ul.querySelector("li");

        // Replace the top menu item text (selected genre) with first genre name (default genre list)
        firstItem.textContent = genres[0].name;
        menuDisplay(true, genres);
    });

    // Hide menu when mouse leaves the area and display the current selected genre
    menu.addEventListener("mouseleave", () => {
        menuOuvert = false;
        const ul = document.getElementById("genres");
        const firstItem = ul.querySelector("li");

        // Restore the selected genre textin the top menu item
        firstItem.textContent = selectedGenre;
        menuDisplay(false, genres);

        // rebuild the movies mosaik with the new genre
        // ----- Others Mosaik -----
        rebuildOthers(selectedGenre);
    });
}



===========================================================================================
    ./scripts/ui/modal.js 
===========================================================================================
// modal.js
//
// Manage Modal Display
//
// ==================================================

// --------------------------------------------------
// Toggle modal display
//
// input: - none
// output: - DOM updated, modal shown or hidden
//
// --------------------------------------------------
//
function Toggle_modale() {
    const mod = document.querySelector("#modale");
    mod.classList.toggle("hidden_modale");
}



===========================================================================================
    ./scripts/ui/tiles.js 
===========================================================================================
// tiles.js
//
// Generate the page tiles
//
// =======================================================================

// --------------------------------------------------
// Generate tiles HTML for a given category and list of movies
//
// input: - categoryName: string (ex: "Mystery")
//        - movies: array [{id, title, image_url}]
// output: - DOM updated with tiles
//
// --------------------------------------------------
function generateTiles(categoryName, movies) {
    // Find the bloc_film element for the given category
    const bloc = document.querySelector(`.bloc_film[data-category="${categoryName}"]`);
    if (!bloc) {
        console.warn("No bloc found for category:", categoryName);
        return;
    }

    // Get container for tiles
    const tuilesContainer = bloc.querySelector(".tuiles");
    if (!tuilesContainer) {
        console.warn("No tuiles container in bloc:", categoryName);
        return;
    }

    tuilesContainer.innerHTML = "";

    // Assign tuile classes for responsiveness
    const tuileClasses = ["tuile_1", "tuile_1", "tuile_2", "tuile_2", "tuile_3", "tuile_3"];

    movies.forEach((movie, index) => {
        const tuileClass = tuileClasses[index % tuileClasses.length];

        tuilesContainer.insertAdjacentHTML("beforeend", `
            <div class="${tuileClass}">
                <div class="tuile_pic">
                    <img src="${movie.image_url}" alt="${movie.title}" onerror="this.style.display='none';">
                </div>
                <div class="tuile_bloctexte">
                    <div class="tuile_bloctexte_texte">${movie.title}</div>
                    <button class="tuile_bloctexte_button" data-id="${movie.id}">
                        Détails
                    </button>
                </div>
            </div>
        `);
    });
}


// --------------------------------------------------
// Generate the "Best movie" section (single film)
//
// input: - movie: object {id, title, image_url, description}
// output: - DOM updated with the best movie info
//
// --------------------------------------------------
function generateBestMovie(movie) {
    const bloc = document.querySelector(".bloc_film[data-category='best']");
    if (!bloc) {
        console.warn("No bloc found for best movie");
        return;
    }

    const vignette = bloc.querySelector(".bf_vignette");
    vignette.innerHTML = `
        <div class="bf_vignette_pic">
            <img src="${movie.image_url}" alt="${movie.title}" onerror="this.style.display='none';">
        </div>
        <div class="bf_vignette_desc">
            <div class="bf_vignette_desc_titre">${movie.title}</div>
            <div class="bf_vignette_desc_texte">${movie.description || ''}</div>
            <button id="btnDetails" class="bf_vignette_desc_bouton" data-id="${movie.id}">
                Détails
            </button>
        </div>
    `;
}

async function rebuildOthers(selectedGenre) {
    // rebuild the movies mosaik with the new genre
    // ----- Others Mosaik -----
    const moviesOthers = await extractBestMoviesByGenre(selectedGenre);
    generateTiles("others", moviesOthers);
}



